<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Day10 TOEICæ¨¡æ“¬ã‚¯ã‚¤ã‚ºï¼ˆå•é¡Œéš ã—ï¼‹é¸æŠè‚¢å¸¸æ™‚è¡¨ç¤ºï¼‰</title>
  <style>
    body { font-family: Arial, sans-serif; text-align: center; margin: 40px; }
    .option-btn { margin: 5px; padding: 10px 20px; border: 1px solid #ccc; cursor: pointer; }
    .correct { color: green; font-weight: bold; }
    .incorrect { color: red; font-weight: bold; }
    #timer { font-size: 1.5em; color: #667eea; margin: 10px; }
    #question { visibility: hidden; }
  </style>
</head>
<body>
  <h1>ğŸ“ TOEICæ¨¡æ“¬ã‚¯ã‚¤ã‚º</h1>

  <!-- Timer -->
  <p id="timer">03:00</p>
  <button onclick="startTraining()">Start Training (3 minutes)</button>

  <!-- Quiz -->
  <p id="question">ã“ã“ã«å•é¡ŒãŒè¡¨ç¤ºã•ã‚Œã¾ã™</p>
  <div id="options"></div>
  <p id="result"></p>
  <p id="score"></p>

  <script>
    const quizData = [
      { part: "Part 2", question: " When will you confirm the schedule?",
        options: ["â‘  I confirmed it yesterday.", "â‘¡ Yes, I like the schedule.", "â‘¢ I will confirm it tomorrow."],
        answer: 2 },
      { part: "Part 2", question: " Could you announce the results at the meeting?",
        options: ["â‘  Yes, I will announce them.", "â‘¡ No, I donâ€™t like meetings.", "â‘¢ The results are very interesting."],
        answer: 0 },
      { part: "Part 3", dialogueContext: "M: The supplier delayed the delivery. W: I'll contact them and adjust the schedule.",
        question: "What will the woman do?",
        options: ["â‘  Contact the supplier and adjust the schedule.", "â‘¡ Cancel the order.", "â‘¢ Ignore the delay."],
        answer: 0 },
      { part: "Part 4", dialogueContext: "[Announcement] Attention: The equipment inspection will take place tomorrow morning.",
        question: "What is the announcement about?",
        options: ["â‘  Equipment inspection", "â‘¡ A new contract", "â‘¢ Office closure"],
        answer: 0 }
    ];

    let current = 0, score = 0;
    let countdown, autoProgress;

    function startTraining() {
      let timeRemaining = 3 * 60;
      document.querySelector("button").disabled = true;

      countdown = setInterval(() => {
        timeRemaining--;
        let m = Math.floor(timeRemaining / 60);
        let s = timeRemaining % 60;
        document.getElementById("timer").textContent =
          (m < 10 ? "0" : "") + m + ":" + (s < 10 ? "0" : "") + s;
        if (timeRemaining <= 0) {
          clearInterval(countdown);
          endQuiz("â± æ™‚é–“çµ‚äº†ï¼ãŠç–²ã‚Œã•ã¾ã§ã—ãŸã€‚");
        }
      }, 1000);

      loadQuestion();
    }

    function loadQuestion() {
      clearTimeout(autoProgress);
      if (current >= quizData.length) {
        endQuiz("ğŸ‰ ã‚¯ã‚¤ã‚ºçµ‚äº†ï¼");
        return;
      }
      const q = quizData[current];
      document.getElementById("question").style.visibility = "hidden";
      document.getElementById("options").innerHTML = "";

      // é¸æŠè‚¢ã¯å¸¸æ™‚è¡¨ç¤º
      const optionsDiv = document.getElementById("options");
      q.options.forEach((opt, i) => {
        const btn = document.createElement("button");
        btn.textContent = opt;
        btn.className = "option-btn";
        btn.onclick = () => checkAnswer(i, q.answer);
        optionsDiv.appendChild(btn);
      });

      // éŸ³å£°èª­ã¿ä¸Šã’é–‹å§‹
      speakQuestion(q);
    }

    function showQuestion(q) {
      document.getElementById("question").style.visibility = "visible";
      if (q.dialogueContext) {
        document.getElementById("question").textContent = q.dialogueContext + "\n\nQ: " + q.question;
      } else {
        document.getElementById("question").textContent = q.part + " - " + q.question;
      }
    }

    function checkAnswer(selected, correct) {
      clearTimeout(autoProgress);
      if (selected === correct) {
        document.getElementById("result").textContent = "âœ“ æ­£è§£ï¼";
        document.getElementById("result").className = "correct";
        score++;
      } else {
        document.getElementById("result").textContent = "âœ— ä¸æ­£è§£â€¦";
        document.getElementById("result").className = "incorrect";
      }
      document.getElementById("score").textContent = "ç¾åœ¨ã®ã‚¹ã‚³ã‚¢ï¼š" + score + " / " + quizData.length;
      setTimeout(nextQuestion, 3000);
    }

    function nextQuestion() {
      current++;
      loadQuestion();
    }

    function endQuiz(message) {
      clearInterval(countdown);
      clearTimeout(autoProgress);
      document.getElementById("question").textContent = message;
      document.getElementById("options").innerHTML = "";
      document.getElementById("result").textContent = "";
      document.getElementById("score").textContent =
        "æœ€çµ‚ã‚¹ã‚³ã‚¢ï¼š" + score + " / " + quizData.length;
    }

    // éŸ³å£°èª­ã¿ä¸Šã’
    function speakQuestion(q) {
      window.speechSynthesis.cancel();
      if (q.dialogueContext) {
        const d = new SpeechSynthesisUtterance(q.dialogueContext);
        d.lang = "en-US"; d.rate = 0.95;
        d.onend = () => {
          const u = new SpeechSynthesisUtterance(q.question);
          u.lang = "en-US"; u.rate = 0.95;
          u.onend = () => showQuestion(q); // èª­ã¿çµ‚ãˆãŸã‚‰å•é¡Œæ–‡ã‚’è¡¨ç¤º
          speechSynthesis.speak(u);
        };
        speechSynthesis.speak(d);
      } else {
        const utterance = new SpeechSynthesisUtterance(q.question);
        utterance.lang = "en-US"; utterance.rate = 0.95;
        utterance.onend = () => showQuestion(q); // èª­ã¿çµ‚ãˆãŸã‚‰å•é¡Œæ–‡ã‚’è¡¨ç¤º
        speechSynthesis.speak(utterance);
      }
    }
  </script>
</body>
</html>
